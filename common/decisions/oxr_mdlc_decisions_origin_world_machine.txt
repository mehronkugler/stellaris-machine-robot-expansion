oxr_mdlc_decisions_origin_wm_start_world_with_core = {
	# owned_planets_only = yes

	# enactment_time = 60
	potential = {
		exists = space_owner
		space_owner = {
			has_origin = oxr_mdlc_origin_world_machine_awakened
		}
		is_planet_world_machine = no
		oxr_mdlc_planet_can_become_world_machine = yes
	}
	allow = {
		always = yes
		is_terraforming = no
		space_owner = {
			has_resource = {
				type = oxr_mdlc_world_machine_core amount >= 1
			}
		}
	}
	resources = {
		category = decisions
		cost = {
			energy = 2500
		}
	}
	effect = {
		start_terraform_process = xvcv_mdlc_pc_machine_auto
	}
}
oxr_mdlc_decisions_origin_wm_reboot_ruined_world = {
	owned_planets_only = no
	potential = {
		exists = space_owner
		space_owner = { has_origin = oxr_mdlc_origin_world_machine_awakened }
		is_planet_class = xvcv_mdlc_pc_machine_auto_ruined
	}
	allow = {
		always = yes
		is_terraforming = no
		space_owner = {
			has_resource = {
				type = energy amount >= 5000
			}
			NOT = {
				any_situation = {
					is_situation_type = oxr_mdlc_origin_wm_situation_restore_ruined_world_machine
				}
			}
		}
	}
	resources = {
		category = decisions
		cost = {
			energy = 5000
		}
	}
	effect = {
		save_global_event_target_as = oxr_mdlc_ruined_world_machine
		log = "Ruined WM target set to \\[event_target:oxr_mdlc_ruined_world_machine.GetName]"
		space_owner = {
			start_situation = {
				type = oxr_mdlc_origin_wm_situation_restore_ruined_world_machine
				# target = oxr_mdlc_ruined_world_machine
				target = event_target:oxr_mdlc_ruined_world_machine
				# target = owner
				effect = {
					set_situation_approach = oxr_mdlc_origin_wm_situation_restore_ruined_world_machine_approach_pause
				}
			}
			# Starting event screen
			country_event = {
				id = oxr_mdlc_origin_wm_main.1000
			}
		}
		
	}
}

oxr_mdlc_decisions_origin_wm_start_auto_build_core = {
	owned_planets_only = yes
	# enactment_time = @oxr_mdlc_world_machine_core_build_time_days  # 1080
	enactment_time = 15
	# resources = {
	# 	category = decisions
	# 	cost = {
	# 		energy = @oxr_mdlc_world_machine_core_build_cost_energy  # 5000
	# 		alloys = @oxr_mdlc_world_machine_core_build_cost_alloys  # 1500
	# 	}
	# }
	potential = {
		exists = space_owner
		space_owner = {
			has_origin = oxr_mdlc_origin_world_machine_awakened
			has_technology = oxr_mdlc_tech_world_machine_wmc_core
			NOT = {
				has_country_flag = oxr_mdlc_world_machine_tech_stolen
			}
		}
		is_planet_world_machine = yes
		NOT = {
			has_modifier = oxr_mdlc_origin_world_machine_core_manufacturing_in_progress
			has_planet_flag = oxr_mdlc_origin_world_machine_core_auto_build_enabled
		}
		has_building = oxr_mdlc_world_machines_building_core_fabrication_depot
	}
	allow = {
		space_owner = {
			has_resource = {
				type = alloys
				amount >= @oxr_mdlc_world_machine_core_build_cost_alloys
			}
			has_resource = {
				type = energy
				amount >= @oxr_mdlc_world_machine_core_build_cost_energy
			}
		}
		NOT = {
			has_modifier = oxr_mdlc_origin_world_machine_core_manufacturing_in_progress
		}
	}
	effect = {
		custom_tooltip = "oxr_mdlc_decisions_origin_wm_start_auto_build_core.tooltip"
		hidden_effect = {
			# add_modifier = {
			# 	modifier = oxr_mdlc_origin_world_machine_core_manufacturing_in_progress
			# }
			set_planet_flag = oxr_mdlc_origin_world_machine_core_auto_build_enabled
			planet_event = {
				id = oxr_mdlc_origin_wm_main.1299
			}
			
		}
	}
}

oxr_mdlc_decisions_origin_wm_start_auto_build_core_stop = {
	owned_planets_only = yes
	enactment_time = 15  # 1080
	resources = {
		category = decisions
		cost = { }
	}
	potential = {
		exists = space_owner
		space_owner = {
			has_origin = oxr_mdlc_origin_world_machine_awakened
			has_technology = oxr_mdlc_tech_world_machine_wmc_core
			NOT = {
				has_country_flag = oxr_mdlc_world_machine_tech_stolen
			}
		}
		is_planet_world_machine = yes
		OR = {
			has_modifier = oxr_mdlc_origin_world_machine_core_manufacturing_in_progress
			has_planet_flag = oxr_mdlc_origin_world_machine_core_auto_build_enabled
		}
		
	}
	allow = {
		# has_building = oxr_mdlc_world_machines_building_core_fabrication_depot
		has_planet_flag = oxr_mdlc_origin_world_machine_core_auto_build_enabled
		always = yes
	}
	effect = {
		custom_tooltip = "oxr_mdlc_decisions_origin_wm_manufacture_core_stop.tooltip"
		hidden_effect = {
			remove_modifier = oxr_mdlc_origin_world_machine_core_manufacturing_in_progress
			remove_planet_flag = oxr_mdlc_origin_world_machine_core_auto_build_enabled
		}
		
	}
}

oxr_mdlc_decisions_origin_wm_restock_armies = {
	owned_planets_only = yes
	enactment_time = 7
	resources = {
		category = decisions
		cost = { }
	}
	potential = {
		exists = space_owner
		space_owner = {
			has_origin = oxr_mdlc_origin_world_machine_awakened
		}
		is_planet_world_machine = yes
		NOT = { has_planet_flag = oxr_mdlc_world_machines_refilling_armies_active }
		NOT = { has_modifier = oxr_mdlc_world_machine_district_army_decommissioning_in_progress }
		oxr_mdlc_planet_can_refill_district_defense_armies = yes
	}
	allow = {
		has_ground_combat = no
	}
	effect = {
		custom_tooltip = oxr_mdlc_decisions_origin_wm_restock_armies_effect
		hidden_effect = {
			# set_planet_flag = oxr_mdlc_world_machines_refilling_armies_active
			# add_modifier = {
			# 	modifier = oxr_mdlc_world_machine_district_army_restock_in_progress
			# 	days = 7
			# }
			# planet_event = {
			# 	id = oxr_mdlc_origin_wm_main.2001
			# }
			# oxr_mdlc_planet_start_refilling_district_defense_armies = yes
			planet_event = {
				id = oxr_mdlc_origin_wm_main.2000
			}
		}
	}
}

oxr_mdlc_decisions_origin_wm_requisition_automatons = {
	owned_planets_only = yes
	enactment_time = 7
	resources = {
		category = oxr_mdlc_category_wm_decisions
		cost = {
			energy = 1000
			alloys = 250
		}
	}
	potential = {
		exists = space_owner
		space_owner = {
			has_origin = oxr_mdlc_origin_world_machine_awakened
		}
		is_planet_world_machine = yes
	}
	allow = {
		space_owner = {
			has_resource = {
				type = energy amount >= 1000
			}
			has_resource = {
				type = alloys amount >= 250
			}
		}
		# TODO: Check max supported automatons on planet (?)
		NOR = {
			has_modifier = oxr_mdlc_planet_origin_world_machine_requisitioning_pops
		}
	}
	effect = {
		custom_tooltip = oxr_mdlc_decisions_origin_wm_requisition_automatons_tooltip
		custom_tooltip = oxr_mdlc_decisions_origin_wm_requisition_automatons_tooltip_1
		hidden_effect = {
			add_modifier = {
				modifier = oxr_mdlc_planet_origin_world_machine_requisitioning_pops
				days = 60
			}
			planet_event = {
				id = oxr_mdlc_origin_wm_main.2100
				days = 60
			}
		}
	}
}

# Toggle WMC production
# oxr_mdlc_decisions_origin_wm_fabricate_core_resource = {
# 	owned_planets_only = yes
# 	enactment_time = 14
# 	resources = {
# 		category = oxr_mdlc_category_wm_decisions
# 		cost = {
# 			energy = 100
# 		}
# 	}
# 	potential = {
# 		exists = space_owner
# 		space_owner = {
# 			has_origin = oxr_mdlc_origin_world_machine_awakened
# 			has_technology = oxr_mdlc_tech_world_machine_wmc_core
# 		}
# 		is_planet_world_machine = yes
# 		NOT = {
# 			has_modifier = oxr_mdlc_origin_world_machine_core_manufacturing_in_progress
# 		}
# 	}
# }

oxr_mdlc_decision_machine_ecu_project = {
	owned_planets_only = yes
	enactment_time = 3600

	resources = {
		category = decisions
		cost = {
			influence = 200
			minerals = 20000
		}
	}

	potential = {
		exists = from
		# Planet is not a T3 world-machine already, but Auto-Machine World is OK
		xvcv_mdlc_world_machines_planet_classes_trigger = no
		# Not allowed for habitats/ringworlds
		habitable_structure = no
		# rikk_mdlc_planet_can_become_world_machine_AP = yes
		owner = { oxr_mdlc_country_can_make_t3_ecu = yes }
	}

	allow = {
		custom_tooltip_fail = {
			text = xvcv_mdlc_world_machines_decisions_tooltip.fail
			num_districts = { type = any value < 1 }
		}
		num_uncleared_blockers < 1
	}

	effect = {
		custom_tooltip = xvcv_mdlc_decision_machine_ecu_project_tooltip
		hidden_effect = {
			clear_deposits = yes
			change_pc = xvcv_mdlc_pc_machine_ecu
			owner = {
				if = {
					limit = { has_country_flag = xvcv_mdlc_decision_machine_ecu_project_message_on }
					create_message = {
						type = XVCV_MDLC_WORLD_MACHINES_COMPLETION_MESSAGE_TYPE
						localization = XVCV_MDLC_DECISION_MACHINE_ECU_PROJECT_DONE_MESSAGE
						days = 10
						target = prev
						variable = {
							type = name
							localization = XVCV_MDLC_DECISION_MACHINE_ECU_PROJECT_PLANET
							scope = prev
						}
					}
				}
			}
			if = {
				limit = { NOT = { has_modifier = planet_population_control_gestalt } }
				add_modifier = { modifier = planet_population_control_gestalt days = -1 }
			}
			add_modifier = { modifier = xvcv_mdlc_world_machines_districts_heat_indicator_neutral days = -1 }
			xvcv_mdlc_planet_terraforming_resolution_breached_effect = yes
		}
		owner = {
			if = {
				limit = {
					#one time only #wait until it appears in the tech option list if you are to research it further
					NOR = {
						has_tech_option = xvcv_mdlc_tech_world_machines_districts_produces
						has_technology = xvcv_mdlc_tech_world_machines_districts_produces
					}
				}
				add_research_option = xvcv_mdlc_tech_world_machines_districts_produces
			}
		}
	}

	ai_weight = {
		weight = 0
		modifier = {
			weight = 100
			owner = { NOT = { any_owned_planet = { is_planet_class = xvcv_mdlc_pc_machine_ecu } } }
		}
	}
}
oxr_mdlc_decision_machine_cpu_project = {
	owned_planets_only = yes
	enactment_time = 3600

	resources = {
		category = decisions
		cost = {
			influence = 200
			minerals = 20000
		}
	}

	potential = {
		exists = owner
		xvcv_mdlc_world_machines_planet_classes_trigger = no
		habitable_structure = no
		rikk_mdlc_planet_can_become_world_machine_AP = yes
		owner = { oxr_mdlc_country_can_make_t3_cpu = yes }
	}

	allow = {
		custom_tooltip_fail = {
			text = xvcv_mdlc_world_machines_decisions_tooltip.fail
			num_districts = { type = any value < 1 }
		}
		num_uncleared_blockers < 1
	}

	effect = {
		custom_tooltip = xvcv_mdlc_decision_machine_cpu_project_tooltip
		hidden_effect = {
			clear_deposits = yes
			change_pc = xvcv_mdlc_pc_machine_cpu
			owner = {
				if = {
					limit = { has_country_flag = xvcv_mdlc_decision_machine_cpu_project_message_on }
					create_message = {
						type = XVCV_MDLC_WORLD_MACHINES_COMPLETION_MESSAGE_TYPE
						localization = XVCV_MDLC_DECISION_MACHINE_CPU_PROJECT_DONE_MESSAGE
						days = 10
						target = prev
						variable = {
							type = name
							localization = XVCV_MDLC_DECISION_MACHINE_CPU_PROJECT_PLANET
							scope = prev
						}
					}
				}
			}
			if = {
				limit = { NOT = { has_modifier = planet_population_control_gestalt } }
				add_modifier = { modifier = planet_population_control_gestalt days = -1 }
			}
			add_modifier = { modifier = xvcv_mdlc_world_machines_districts_heat_indicator_neutral days = -1 }
			xvcv_mdlc_planet_terraforming_resolution_breached_effect = yes
		}
		owner = {
			if = {
				limit = {
					NOR = {
						has_tech_option = xvcv_mdlc_tech_world_machines_districts_produces
						has_technology = xvcv_mdlc_tech_world_machines_districts_produces
					}
				}
				add_research_option = xvcv_mdlc_tech_world_machines_districts_produces
			}
		}
	}

	ai_weight = {
		weight = 0
		modifier = {
			weight = 100
			owner = { NOT = { any_owned_planet = { is_planet_class = xvcv_mdlc_pc_machine_cpu } } }
		}
	}
}
oxr_mdlc_decision_machine_ser_project = {
	owned_planets_only = yes
	enactment_time = 3600

	resources = {
		category = decisions
		cost = {
			influence = 200
			minerals = 20000
		}
	}

	potential = {
		exists = owner
		# owner = { oxr_mdlc_planet_owner_can_build_wm_districts = yes }
		xvcv_mdlc_world_machines_planet_classes_trigger = no
		habitable_structure = no
		rikk_mdlc_planet_can_become_world_machine_AP = yes
		owner = { oxr_mdlc_country_can_make_t3_ser = yes }
	}

	allow = {
		custom_tooltip_fail = {
			text = xvcv_mdlc_world_machines_decisions_tooltip.fail
			num_districts = { type = any value < 1 }
		}
		num_uncleared_blockers < 1
	}

	effect = {
		custom_tooltip = xvcv_mdlc_decision_machine_ser_project_tooltip
		hidden_effect = {
			clear_deposits = yes
			change_pc = xvcv_mdlc_pc_machine_ser
			owner = {
				if = {
					limit = { has_country_flag = xvcv_mdlc_decision_machine_ser_project_message_on }
					create_message = {
						type = XVCV_MDLC_WORLD_MACHINES_COMPLETION_MESSAGE_TYPE
						localization = XVCV_MDLC_DECISION_MACHINE_SER_PROJECT_DONE_MESSAGE
						days = 10
						target = prev
						variable = {
							type = name
							localization = XVCV_MDLC_DECISION_MACHINE_SER_PROJECT_PLANET
							scope = prev
						}
					}
				}
			}
			if = {
				limit = { NOT = { has_modifier = planet_population_control_gestalt } }
				add_modifier = { modifier = planet_population_control_gestalt days = -1 }
			}
			add_modifier = { modifier = xvcv_mdlc_world_machines_districts_heat_indicator_neutral days = -1 }
			xvcv_mdlc_planet_terraforming_resolution_breached_effect = yes
		}
		owner = {
			if = {
				limit = {
					NOR = {
						has_tech_option = xvcv_mdlc_tech_world_machines_districts_produces
						has_technology = xvcv_mdlc_tech_world_machines_districts_produces
					}
				}
				add_research_option = xvcv_mdlc_tech_world_machines_districts_produces
			}
		}
	}

	ai_weight = {
		weight = 0
		modifier = {
			weight = 100
			owner = { NOT = { any_owned_planet = { is_planet_class = xvcv_mdlc_pc_machine_ser } } }
		}
	}
}

# A copy of xvcv_mdlc_decision_machine_world_automation
oxr_mdlc_decision_machine_world_automation = {
	owned_planets_only = yes
	enactment_time = 720

	resources = {
		category = decisions
		cost = {
			oxr_mdlc_world_machine_core = 1
		}
	}

	potential = {
		exists = owner
		owner = { has_origin = oxr_mdlc_origin_world_machine_awakened }
		oxr_mdlc_planet_can_become_world_machine = yes
	}

	effect = {
		xvcv_mdlc_decision_machine_world_automation_effect = yes
	}

	ai_weight = {
		weight = 0
		modifier = {
			weight = 100
			owner = { NOT = { any_owned_planet = { is_planet_class = xvcv_mdlc_pc_machine_auto } } }
		}
	}
}
#auto worlds
#	xvcv_mdlc_pc_machine_auto
#	xvcv_mdlc_pc_ringworld_machine_auto
#	xvcv_mdlc_pc_machine_ecu
#	xvcv_mdlc_pc_machine_cpu
#	xvcv_mdlc_pc_machine_ser

@wmupgradelength1 = 400
@wmupgradelength2 = 600
@wmupgradelength3 = 800

rikk_mdlc_decision_world_machine_crust_roots = {
	owned_planets_only = yes
	enactment_time = @wmupgradelength2
	
	resources = {
		category = decisions
		cost = {
			minerals = 2000
		}
	}	
	potential = {
		exists = owner
		owner = {
			AND = {
				oxr_mdlc_planet_owner_can_build_wm_districts = yes 
				has_technology = rikk_mdlc_tech_world_machine_crust_upgrade
			}
		}
		rikk_mdlc_is_wm_planet_trigger = yes
		NOT = { has_deposit = rikk_mdlc_d_world_machine_crust_roots }
	}
	
	on_queued = { set_planet_flag = crust_roots_queued }
	on_unqueued = { remove_planet_flag = crust_roots_queued }
	
	effect = {
		add_deposit = rikk_mdlc_d_world_machine_crust_roots
		remove_planet_flag = crust_roots_queued
	}
}

rikk_mdlc_decision_world_machine_cooling_towers = {
	owned_planets_only = yes
	enactment_time = @wmupgradelength2
	
	resources = {
		category = decisions
		cost = {
			alloys = 1000
		}
	}	
	potential = {
		exists = owner
		rikk_mdlc_is_wm_planet_trigger = yes
		owner = {
			AND = {
				oxr_mdlc_planet_owner_can_build_wm_districts = yes 
				has_technology = rikk_mdlc_tech_world_machine_mantle_upgrade
			}
		}
		NOT = { is_planet_class = xvcv_mdlc_pc_machine_auto }
		NOT = { has_deposit = rikk_mdlc_d_world_machine_cooling_towers }
	}
	
	allow = {
		custom_tooltip = {
			fail_text = rikk_mdlc_fail_crust_roots_queued
			OR = { 
				has_deposit = rikk_mdlc_d_world_machine_crust_roots
				has_planet_flag = crust_roots_queued
			}
		}
	}
	
	effect = {
		add_deposit = rikk_mdlc_d_world_machine_cooling_towers
		hidden_effect = { planet_event = { id = rikk_mdlc_wm_upgrade_events.70 days = 1 } }
	}
}


#Mantle
rikk_mdlc_decision_world_machine_mantle_roots = {
	owned_planets_only = yes
	enactment_time = @wmupgradelength3
	
	resources = {
		category = decisions
		cost = {
			minerals = 2000
			energy = 2000
		}
	}	
	potential = {
		exists = owner
		owner = {
			AND = {
				oxr_mdlc_planet_owner_can_build_wm_districts = yes 
				has_technology = rikk_mdlc_tech_world_machine_mantle_upgrade
			}
		}
		rikk_mdlc_is_wm_planet_trigger = yes
		NOT = { has_deposit = rikk_mdlc_d_world_machine_mantle_roots }
	}
	
	allow = {
		custom_tooltip = {
			fail_text = rikk_mdlc_fail_crust_roots_queued
			OR = { 
				has_deposit = rikk_mdlc_d_world_machine_crust_roots
				has_planet_flag = crust_roots_queued
			}
		}
	}
	
	on_queued = { set_planet_flag = mantle_roots_queued }
	on_unqueued = { remove_planet_flag = mantle_roots_queued }
	
	effect = {
		add_deposit = rikk_mdlc_d_world_machine_mantle_roots
		remove_planet_flag = mantle_roots_queued
	}
}


rikk_mdlc_decision_world_machine_mantle_engine = {
	owned_planets_only = yes
	enactment_time = @wmupgradelength1
	
	resources = {
		category = decisions
		cost = {
			alloys = 1000
		}
	}	
	potential = {
		exists = owner
		rikk_mdlc_is_wm_planet_trigger = yes
		owner = { has_technology = rikk_mdlc_tech_world_machine_mantle_upgrade }
		NOT = { has_deposit = rikk_mdlc_d_world_machine_mantle_engine }
	}
	
	allow = {
		custom_tooltip = {
			fail_text = rikk_mdlc_fail_mantle_roots_queued
			OR = { 
				has_deposit = rikk_mdlc_d_world_machine_mantle_roots
				has_planet_flag = mantle_roots_queued
			}
		}
	}
	
	on_queued = { set_planet_flag = mantle_engine_queued }
	on_unqueued = { remove_planet_flag = mantle_engine_queued }
	
	effect = {
		add_deposit = rikk_mdlc_d_world_machine_mantle_engine
		hidden_effect = { remove_planet_flag = mantle_engine_queued }
	}
}

rikk_mdlc_decision_world_machine_reinforced_planet = {
	owned_planets_only = yes
	enactment_time = @wmupgradelength1
	
	resources = {
		category = decisions
		cost = {
			minerals = 750
			mult = value:count_world_machines_districts_not_cooling
		}
	}
	
	potential = {
		exists = owner
		rikk_mdlc_is_wm_planet_trigger = yes
		owner = { has_technology = rikk_mdlc_tech_world_machine_mantle_upgrade }
		NOT = { has_planet_flag = rikk_mdlc_planet_reinforced }
	}
	
	allow = {
		custom_tooltip = {
			fail_text = rikk_mdlc_fail_mantle_engine_queued
			OR = {
				has_deposit = rikk_mdlc_d_world_machine_mantle_engine
				has_planet_flag = mantle_engine_queued
			}
		}
	}
	
	effect = {
		set_planet_flag = rikk_mdlc_planet_reinforced
		custom_tooltip = rikk_mdlc_decision_world_machine_reinforced_planet_effect
	}
}

#Outer_Core
rikk_mdlc_decision_world_machine_outer_core_roots = {
	owned_planets_only = yes
	enactment_time = @wmupgradelength3
	
	resources = {
		category = decisions
		cost = {
			minerals = 5000
			energy = 5000
		}
	}	
	potential = {
		exists = owner
		rikk_mdlc_is_wm_planet_trigger = yes
		owner = { oxr_mdlc_planet_owner_can_build_wm_districts = yes }
		owner = { has_technology = rikk_mdlc_tech_world_machine_outer_core_upgrade }
		NOT = { has_deposit = rikk_mdlc_d_world_machine_outer_core_roots }
	}
	
	allow = {
		custom_tooltip = {
			fail_text = rikk_mdlc_fail_mantle_roots_queued
			OR = { 
				has_deposit = rikk_mdlc_d_world_machine_mantle_roots
				has_planet_flag = mantle_roots_queued
			}
		}
	}
	
	on_queued = { set_planet_flag = outer_core_roots_queued }
	on_unqueued = { remove_planet_flag = outer_core_roots_queued }
	
	effect = {
		add_deposit = rikk_mdlc_d_world_machine_outer_core_roots
		remove_planet_flag = outer_core_roots_queued
	}
}

rikk_mdlc_decision_world_machine_outer_core_tap = {
	owned_planets_only = yes
	enactment_time = @wmupgradelength2
	
	resources = {
		category = decisions
		cost = {
			alloys = 2000
		}
	}	
	potential = {
		exists = owner
		rikk_mdlc_is_wm_industrial_trigger = yes
		owner = { oxr_mdlc_planet_owner_can_build_wm_districts = yes }
		owner = { has_technology = rikk_mdlc_tech_world_machine_outer_core_upgrade }
		NOT = { has_deposit = rikk_mdlc_d_world_machine_outer_core_tap }
	}
	
	allow = {
		custom_tooltip = {
			fail_text = rikk_mdlc_fail_outer_core_roots_queued
			OR = { 
				has_deposit = rikk_mdlc_d_world_machine_outer_core_roots
				has_planet_flag = outer_core_roots_queued
			}
		}
	}
	
	effect = {
		add_deposit = rikk_mdlc_d_world_machine_outer_core_tap
	}
}

rikk_mdlc_decision_world_machine_outer_core_cooling = {
	owned_planets_only = yes
	enactment_time = 30
	
	resources = {
		category = decisions
		cost = {
			alloys = 2000
		}
	}	
	potential = {
		exists = owner
		rikk_mdlc_is_wm_computer_trigger = yes
		owner = { oxr_mdlc_planet_owner_can_build_wm_districts = yes }
		owner = { has_technology = rikk_mdlc_tech_world_machine_outer_core_upgrade }
		NOT = { has_deposit = rikk_mdlc_d_world_machine_outer_core_cooled }
	}
	
	allow = {
		custom_tooltip = {
			fail_text = rikk_mdlc_fail_outer_core_roots_queued
			OR = {
				has_deposit = rikk_mdlc_d_world_machine_outer_core_roots
				has_planet_flag = outer_core_roots_queued
			}
		}
	}
	
	effect = {
		add_modifier = { modifier = rikk_mdlc_world_machine_outer_core_cooling days = 3 }
		hidden_effect = { planet_event = { id = rikk_mdlc_wm_upgrade_events.110 days = 3 } }
	}
}

#Inner_Core
rikk_mdlc_decision_world_machine_inner_core_roots = {
	owned_planets_only = yes
	enactment_time = @wmupgradelength3
	
	resources = {
		category = decisions
		cost = {
			minerals = 5000
			energy = 10000
		}
	}	
	potential = {
		exists = owner
		owner = {
			AND = {
				oxr_mdlc_planet_owner_can_build_wm_districts = yes 
				has_technology = rikk_mdlc_tech_world_machine_inner_core_upgrade
			}
		}
		rikk_mdlc_is_wm_planet_trigger = yes
		NOT = { has_deposit = rikk_mdlc_d_world_machine_inner_core_roots }
	}
	
	allow = {
		custom_tooltip = {
			fail_text = rikk_mdlc_fail_outer_core_roots_queued
			OR = { 
				has_deposit = rikk_mdlc_d_world_machine_outer_core_roots
				has_planet_flag = outer_core_roots_queued
			}
		}
	}
	
	on_queued = { set_planet_flag = inner_core_roots_queued }
	on_unqueued = { remove_planet_flag = inner_core_roots_queued }
	
	effect = {
		add_deposit = rikk_mdlc_d_world_machine_inner_core_roots
		hidden_effect = { remove_planet_flag = inner_core_roots_queued }
	}
}

#core core
rikk_mdlc_decision_world_machine_core_core = {
	owned_planets_only = yes
	enactment_time = 30
	
	resources = {
		category = decisions
		cost = {
			alloys = 7500
			unity = 7500
		}
	}
	potential = {
		exists = owner
		rikk_mdlc_is_wm_planet_trigger = yes
		owner = { has_technology = rikk_mdlc_tech_world_machine_inner_core_upgrade }
		NOR = {
			has_planet_flag = rikk_mdlc_core_core_installed
			has_planet_flag = rikk_mdlc_situation_core_core_active
		}
	}
	
	allow = {
		custom_tooltip = {
			fail_text = rikk_mdlc_fail_inner_core_roots_queued
			OR = { 
				has_deposit = rikk_mdlc_d_world_machine_inner_core_roots
				has_planet_flag = inner_core_roots_queued
			}
		}
		custom_tooltip = {
			fail_text = rikk_mdlc_fail_inner_core_project_queued
			NOT = { has_planet_flag = inner_core_tap_queued }
		}
	}
	
	on_queued = { set_planet_flag = core_core_queued }
	on_unqueued = { remove_planet_flag = core_core_queued }
	
	effect = {
		hidden_effect = {
			remove_planet_flag = core_core_queued
			set_planet_flag = rikk_mdlc_situation_core_core_active
		}
		owner = {
			start_situation = {
				type = rikk_mdlc_situation_core_core
				target = root
			}
		}
	}
}

rikk_mdlc_decision_world_machine_inner_core_tap = {
	owned_planets_only = yes
	enactment_time = @wmupgradelength2
	
	resources = {
		category = decisions
		cost = {
			alloys = 5000
		}
	}
	
	potential = {
		exists = owner
		rikk_mdlc_is_wm_planet_trigger = yes
		owner = { has_technology = rikk_mdlc_tech_world_machine_inner_core_upgrade }
		NOR = {
			has_deposit = rikk_mdlc_d_world_machine_core_tap
			has_planet_flag = rikk_mdlc_core_core_installed
			has_planet_flag = rikk_mdlc_situation_core_core_active
		}
	}
	
	allow = {
		custom_tooltip = {
			fail_text = rikk_mdlc_fail_outer_core_roots_queued
			OR = {
				has_deposit = rikk_mdlc_d_world_machine_inner_core_roots
				has_planet_flag = inner_core_roots_queued
			}
		}
		custom_tooltip = {
			fail_text = rikk_mdlc_fail_inner_core_project_queued
			NOT = { has_planet_flag = core_core_queued }
		}
	}
	
	on_queued = { set_planet_flag = inner_core_tap_queued }
	on_unqueued = { remove_planet_flag = inner_core_tap_queued }
	
	effect = {
		add_deposit = rikk_mdlc_d_world_machine_core_tap
		hidden_effect = { remove_planet_flag = inner_core_tap_queued }
	}
}

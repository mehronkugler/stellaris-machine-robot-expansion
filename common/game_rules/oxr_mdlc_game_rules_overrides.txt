#Root = species
#This = country
can_release_vassal_from_species = {
	root = {
		OR = {
			# Vanilla
			AND = {
				is_sapient = yes
				NOR = {
					AND = {
						has_trait = trait_machine_unit
						prev.this = { is_individual_machine = no }
					}
					AND = {
						has_trait = trait_hive_mind
						NOT = { prev.this = { has_origin = origin_progenitor_hive } }
					}
					AND = {
						NOT = { has_trait = trait_hive_mind }
						prev.this = { has_authority = auth_hive_mind }
					}
					has_trait = trait_mechanical
					can_think = no
					has_trait = trait_clone_soldier_infertile
					has_trait = trait_clone_soldier_infertile_full_potential
				}
			}
			# MREC
			oxr_mdlc_can_release_vassal_from_species = yes
		}
		
	}
}

#Root = country
#This = planet
can_colonize_planet = {
	custom_tooltip = {
		fail_text = "COLONIZATION_IMPOSSIBLE_UNDER_INVESTIGATION"
		NOT = { has_planet_flag = planet_under_investigation }
	}
	custom_tooltip = {
		fail_text = "COLONIZATION_IMPOSSIBLE_DYSON_SPHERE"
		if = {
			limit = {
				is_artificial = no	# Colonizing habitats is fine
			}
			system_has_dyson_sphere = no
		}
	}
	custom_tooltip = {
		fail_text = "COLONIZATION_IMPOSSIBLE_DYSON_SPHERE_CONSTRUCTION"
		if = {
			limit = {
				system_has_dyson_sphere = no
				is_artificial = no	# Colonizing habitats is fine
			}
			NOT = {
				solar_system = {
					has_star_flag = dyson_sphere_construction
				}
			}
		}
	}
	custom_tooltip = {
		fail_text = "COLONIZATION_IMPOSSIBLE_COSMOGENESIS_EXODUS"
		exists = root
		root = {
			NOT = { owner = { has_event_chain = cosmogenesis_planet_pickup_chain } }
		}
	}
	custom_tooltip = {
		# Machine & Robot Expansion Continued
		fail_text = oxr_mdlc_can_colonize_planet_pc_habitat.fail_active
		NAND = {
			is_planet_class = pc_habitat
			oxr_mdlc_planet_decision_dismantle_habitat_active = yes
		}
	}
}
can_species_be_assembled = {
	is_sapient = yes
	NOT = {
		has_trait = trait_exd
	}
	NOT = {
		AND = {
			has_trait = trait_mechanical
			root.owner = { is_individual_machine = yes }
		}
	}
	NOT = {
		AND = {
			has_virtual_species_trait = yes
			root.owner = {
				is_fallen_empire = no
				has_active_tradition = tr_virtuality_finish
			}
		}
	}
	OR = {
		AND = {
			is_robotic = yes
			root = {
				check_modifier_value = {
					modifier = planet_pop_assembly_add
					value > 0
				}
				owner = {
					NOT = { has_country_flag = synth_assembly_stopped }
				}
			}
			# Machines & Robot Expansion Continued
			has_xvcv_mdlc_trait_bio_robot = no
		}
		AND = {
			is_organic_species = yes
			if = {
				limit = {
					root.owner = { is_hive_empire = yes }
				}
				has_trait = trait_hive_mind
			}
			else_if = {
				limit = { has_budding_trait = yes }
				root = {
					any_owned_species = { is_exact_same_species = prevprev }
				}
			}
			else_if = {
				limit = { has_trait = trait_tiyanki }
				root = {
					any_owned_species = { is_exact_same_species = prevprev }
				}
			}
			else_if = {
				limit = {
					OR = {
						has_trait = trait_clone_soldier_infertile
						has_trait = trait_clone_soldier_infertile_full_potential
					}
				}
				root = {
					# Event 'clones.3' should cover this, but extra safety check.
					has_building = building_clone_army_clone_vat
					NOT = {
						check_variable = {
							which = clone_pops_missing
							value = 0
						}
					}
				}
			}
			else = {
				root = {
					OR = {
						has_building = building_clone_vats
						has_modifier = tiyanki_trophy
						owner = { has_modifier = syamelles_curse }
						AND = {
							has_building = building_posthumous_employment_center
							owner = { has_civic = civic_permanent_employment }
						}
						has_planet_flag = can_organic_assemble_flag #for mod compatibility
					}
				}
			}
		}
	}
	has_population_control = {
		type = no
		country = root.owner
	}
}

# This = pop
# can_resettle_pop = {
# 	# Self-modified Pops won't leave
# 	custom_tooltip = {
# 		fail_text = "self_modified_refuse"
# 		NOT = { has_trait = trait_self_modified }
# 	}
# 	# Pathogenic Pops Can't Resettle
# 	custom_tooltip = {
# 		fail_text = "pathogenic_genes_warning"
# 		NOT = { has_trait = trait_pathogenic_genes }
# 	}
# 	custom_tooltip = {
# 		fail_text = "origin_egalitarian_refuse"
# 		NAND = {
# 			pop_has_ethic = ethic_egalitarian
# 			is_enslaved = no
# 			planet = { has_modifier = paragon_origin_reformists }
# 		}
# 	}
# 	custom_tooltip_fail = {
# 		text = oxr_mdlc_pop_can_migrate.tooltip_fail
# 		oxr_mdlc_pop_can_migrate = yes
# 	}
# 	custom_tooltip = {
# 		fail_text = "no_resettling_apps"
# 		if = {
# 			limit = {
# 				has_virtual_species_trait = yes
# 			}
# 			exists = owner
# 			owner = {
# 				is_fallen_empire = no
# 				NOT = {
# 					has_active_tradition = tr_virtuality_adopt
# 				}
# 			}
# 		}
# 	}
# 	if = { #Done as an IF/ELSE so the tooltip isn't hideous and unreadable
# 		limit = { is_shackled_robot = yes }
# 		always = yes
# 	}
# 	else_if = {
# 		limit = {
# 			planet = {
# 				is_doomsday_planet = yes
# 			}
# 		}
# 		always = yes
# 	}
# 	else_if = {
# 		limit = {
# 			planet = {
# 				has_modifier = planet_culture_shock
# 			}
# 		}
# 		OR = {
# 			is_same_species = planet.owner
# 			planet = {
# 				NOT = { has_modifier = planet_culture_shock }
# 			}
# 		}
# 	}
# 	else_if = {
# 		limit = {
# 			planet = {
# 				is_capital = yes
# 				num_pops < 2
# 			}
# 			NOT = {
# 				owner = {
# 					any_owned_planet = {
# 						is_capital = no
# 						NOT = {
# 							is_planet_class = pc_cosmogenesis_world
# 						}
# 					}
# 				}
# 			}
# 		}
# 		custom_tooltip = {
# 			fail_text = "no_abandon_capital_for_unviable_planet"
# 			always = no
# 		}
# 	}
# 	else_if = {
# 		limit = {
# 			planet = {
# 				is_planet_class = pc_cosmogenesis_world
# 				owner = {
# 					has_ascension_perk = ap_cosmogenesis
# 				}
# 				num_pops < 2
# 			}
# 		}
# 		custom_tooltip = {
# 			fail_text = "no_unfueled_lathe"
# 			always = no
# 		}
# 	}
# 	else_if = {
# 		limit = {
# 			planet = {
# 				has_deposit = d_genesis_preserve
# 				count_owned_pop = {
# 					limit = { is_sapient = yes }
# 					count < 2
# 				}
# 			}
# 			owner = {
# 				is_guided_sapience_empire = yes
# 			}
# 		}
# 		custom_tooltip = {
# 			fail_text = "no_abandon_genesis_preserve"
# 			always = no
# 		}
# 	}
# 	else_if = {
# 		limit = {
# 			owner = {
# 				has_ascension_perk = ap_cosmogenesis
# 			}
# 		}
# 		always = yes
# 	}
# 	else_if = {
# 		limit = {
# 			owner = {
# 				is_gestalt = yes
# 			}
# 		}
# 		always = yes
# 	}
# 	else = {
# 		custom_tooltip = {
# 			fail_text = RESETTLEMENT_POLICY_FAIL
# 			owner = {
# 				has_policy_flag = resettlement_allowed
# 			}
# 		}
# 	}
# }
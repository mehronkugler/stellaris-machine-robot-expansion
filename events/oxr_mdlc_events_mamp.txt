namespace = oxr_mdlc_mamp

#############
## M A M P ##
#############

# Beginning of MAMP event chain
country_event = {
	id = oxr_mdlc_mamp.1
	title = oxr_mdlc_mamp.1.name
	desc = oxr_mdlc_mamp.1.desc
	is_triggered_only = yes
	picture = GFX_evt_physics_research

	trigger = {
		NOT = {
			has_country_flag = oxr_mdlc_mamp_event_chain_started
		}
		is_machine_empire = yes
		has_ascension_perk = oxr_mdlc_ap_mamp
	}

	immediate = {
		set_country_flag = oxr_mdlc_mamp_event_chain_started
		enable_special_project = {
			name = OXR_MDLC_MAMP_CAT_1_FIRST_PROJECT
		}
		if = {
			limit = {
				NOT = {
					has_event_chain = oxr_mdlc_mamp_chain
				}
			}
			begin_event_chain = {
				event_chain = oxr_mdlc_mamp_chain
				target = this
			}
		}
	}
	option = {
		name = oxr_mdlc_mamp.event_default_option.name
		allow = { always = yes }
	}
}
# Conclusion of first research project
# Create a special project in space
country_event = {
	id = oxr_mdlc_mamp.2
	title = oxr_mdlc_mamp.2.name
	desc = oxr_mdlc_mamp.2.desc
	is_triggered_only = yes
	picture = GFX_evt_space_hangar

	trigger = { }

	immediate = {
		capital_scope = {
			solar_system = {
				random_system_planet = {
					limit = {
						is_star = no
						is_colony = no
						is_capital = no
					}
					save_global_event_target_as = oxr_mdlc_mamp_cat_1_research_site
				}
			}
		}
		event_target:oxr_mdlc_mamp_cat_1_research_site = {
			enable_special_project = {
				name = OXR_MDLC_MAMP_CAT_1_FIRST_SITE_PROJECT
				location = this
				owner = ROOT
			}
		}
	}
	option = {
		name = oxr_mdlc_mamp.event_default_option.name
		allow = { always = yes }
	}
}

# Conclusion of first in-space project
# Trigger second research project in space
country_event = {
	id = oxr_mdlc_mamp.3
	title = oxr_mdlc_mamp.3.name
	desc = oxr_mdlc_mamp.3.desc
	is_triggered_only = yes
	picture = GFX_evt_space_hangar
	
	immediate = {
		event_target:oxr_mdlc_mamp_cat_1_research_site = {
			enable_special_project = {
				name = OXR_MDLC_MAMP_CAT_1_SECOND_SITE_PROJECT
				location = this
				owner = ROOT
			}
		}
	}
	option = {
		name = oxr_mdlc_mamp.3.option_1.name
		allow = { always = yes }
	}
}
# Conclusion of second in-space project
country_event = {
	id = oxr_mdlc_mamp.4
	title = oxr_mdlc_mamp.4.name
	desc = oxr_mdlc_mamp.4.desc
	is_triggered_only = yes
	picture = GFX_evt_space_walk

	immediate = {
		enable_special_project = {
			name = OXR_MDLC_MAMP_CAT_1_THIRD_STAGE_GROWTH_PROJ
		}
	}
	option = {
		name = oxr_mdlc_mamp.4.option_1.name
		allow = { always = yes }
	}
}
# Conclusion of special project to make species prototype
country_event = {
	id = oxr_mdlc_mamp.5
	title = oxr_mdlc_mamp.5.name
	desc = oxr_mdlc_mamp.5.desc
	is_triggered_only = yes
	picture = GFX_evt_sapient_AI

	immediate = {
		give_technology = {
			tech = oxr_mdlc_tech_mamp_1
		}
		hidden_effect = {
			create_mamp_cat1_species = yes
		}
	}
	option = {
		name = oxr_mdlc_mamp.5.option_1.name
		allow = { always = yes }
		custom_tooltip = oxr_mdlc_mamp.5.option_1.tooltip
	}
}

## CONTINUOUS EVENTS
planet_event = {
	# Create a MAMP Cat 1 species
	id = oxr_mdlc_mamp.100
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		create_pop = {
			species = event_target:oxr_mdlc_mamp_cat_1_pop_species
		}
		remove_planet_modifier = oxr_mdlc_mamp_auto_construction_active_cat_1
		# fire_on_action = {
		# 	on_action = on_mamp_planet_auto_construction_finished
		# }
	}
}

country_event = {
	id = oxr_mdlc_mamp.200
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		has_ascension_perk = oxr_mdlc_ap_mamp
		has_country_flag = oxr_mdlc_mamp_empire_auto_construction_active
	}

	immediate = {
		oxr_mdlc_mamp_empire_continuously_trigger_auto_construction = yes
		country_event = {
			id = oxr_mdlc_mamp.200
			days = 60
		}
	}
}

country_event = {
	id = oxr_mdlc_mamp.1000
	title = oxr_mdlc_mamp.1000.title
	desc = oxr_mdlc_mamp.1000.desc
	is_triggered_only = yes

	trigger = { }

	option = {
		name = "Activate empire-wide auto-construction of M.A.M.P. Frames"
		trigger = {
			has_ascension_perk = oxr_mdlc_ap_mamp
		}
		allow = {
			NOT = { has_country_flag = oxr_mdlc_mamp_empire_auto_construction_active }
		}
		hidden_effect = {
			set_country_flag = oxr_mdlc_mamp_empire_auto_construction_active
			country_event = {
				id = oxr_mdlc_mamp.1000
			}
		}
	}
	option = {
		name = "Deactivate empire-wide auto-construction of M.A.M.P. Frames"
		trigger = {
			has_ascension_perk = oxr_mdlc_ap_mamp
		}
		allow = {
			has_country_flag = oxr_mdlc_mamp_empire_auto_construction_active
		}
		hidden_effect = {
			remove_country_flag = oxr_mdlc_mamp_empire_auto_construction_active
			oxr_mdlc_mamp_empire_auto_construction_select_none = yes
			country_event = {
				id = oxr_mdlc_mamp.1000
			}
		}
	}
	option = {
		name = "Program all M.A.M.P. bays to produce Cat 1 Frames"
		trigger = {
			has_ascension_perk = oxr_mdlc_ap_mamp
			has_technology = oxr_mdlc_tech_mamp_1
		}
		allow = {
			has_country_flag = oxr_mdlc_mamp_empire_auto_construction_active
			NOT = {
				has_country_flag = oxr_mdlc_mamp_empire_auto_construction_select_cat_1
			}
		}
		hidden_effect = {
			oxr_mdlc_mamp_empire_auto_construction_select_cat_1 = yes
			country_event = {
				id = oxr_mdlc_mamp.1000
			}
		}
	}
	option = {
		name = "Program all M.A.M.P. bays to produce Cat 2 Frames"
		trigger = {
			has_technology = oxr_mdlc_tech_mamp_2
		}
		allow = {
			has_country_flag = oxr_mdlc_mamp_empire_auto_construction_active
			NOT = {
				has_country_flag = oxr_mdlc_mamp_empire_auto_construction_select_cat_2
			}
		}
		hidden_effect = {
			oxr_mdlc_mamp_empire_auto_construction_select_cat_2 = yes
			country_event = {
				id = oxr_mdlc_mamp.1000
			}
		}
	}
	option = {
		name = "Program all M.A.M.P. bays to produce Cat 3 Frames"
		trigger = {
			has_technology = oxr_mdlc_tech_mamp_3
		}
		allow = {
			has_country_flag = oxr_mdlc_mamp_empire_auto_construction_active
			NOT = {
				has_country_flag = oxr_mdlc_mamp_empire_auto_construction_select_cat_3
			}
		}
		hidden_effect = {
			oxr_mdlc_mamp_empire_auto_construction_select_cat_3 = yes
			country_event = {
				id = oxr_mdlc_mamp.1000
			}
		}
	}
	option = {
		name = "Close this window"
		allow = { always = yes }
		default_hide_option = yes
	}
}

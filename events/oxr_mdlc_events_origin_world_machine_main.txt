namespace = oxr_mdlc_origin_wm_main

country_event = {
	id = oxr_mdlc_origin_wm_main.1
	title = oxr_mdlc_origin_wm_starting_overview
	desc = oxr_mdlc_origin_wm_starting_overview_desc
	picture = GFX_evt_ai_planet
	is_triggered_only = yes

	option = {
		name = oxr_mdlc_origin_wm_main.1.a.name
	}
}

# Trigger project to get proficiency tech
# although I am on the fence and maybe just award it
country_event = {
	id = oxr_mdlc_origin_wm_main.50
	title = oxr_mdlc_origin_wm_main.50.title
	desc = oxr_mdlc_origin_wm_main.50.desc
	picture = GFX_evt_engineering_research
	is_triggered_only = yes

	trigger = { }

	option = {
		name = oxr_mdlc_origin_wm_main.50.a
		owner = {
			enable_special_project = {
				name = OXR_MDLC_ORIGIN_WM_TECH_PROFICIENCY
			}
		}
	}
	immediate = {
		owner = {
			end_event_chain = oxr_mdlc_origin_wm_chain_clear_blockers
		}
	}
}

# Finished the 'deploy world cores' event chain
country_event = {
	id = oxr_mdlc_origin_wm_main.60
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_event_chain = "oxr_mdlc_origin_wm_chain_deploy_world_cores"
		NOT = { has_completed_event_chain = oxr_mdlc_origin_wm_chain_deploy_world_cores }
	}
	immediate = {
		# award an insight
		country_event = {
			id = oxr_mdlc_on_world_machine_action.110
		}
		# finish this event chain
		end_event_chain = oxr_mdlc_origin_wm_chain_deploy_world_cores
	}
}

# Planet has been terraformed
# This = Planet
# From = Terraforming country
planet_event = {
	id = oxr_mdlc_origin_wm_main.500
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		from = {
			has_origin = oxr_mdlc_origin_world_machine_awakened
		}
	}

	immediate = {
		create_colony = {
			owner = from
			species = from.owner_species
			# Set name .. read a variable on the planet as a list index
			# then according to that, set the name
		}
		add_deposit = oxr_mdlc_d_world_machine_core
		if = {
			limit = {
				from = {
					NOT = {
						has_technology = oxr_mdlc_tech_world_machine_planetary_mastery
					}
				}
			}
			oxr_mdlc_origin_world_machine_random_add_all_blockers = yes
			oxr_mdlc_origin_world_machine_create_digsite_for_blocker = yes
			# Don't trigger the event post-terraform if planet was ruined
			if = {
				limit = {
					has_planet_flag = oxr_mdlc_ruined_world_machine
				}
				remove_planet_flag = oxr_mdlc_ruined_world_machine
			}
			else = {
				planet_event = {
					id = oxr_mdlc_origin_wm_main.501
				}
			}
		}
		add_modifier = { modifier = "planet_population_control_gestalt" days = -1 }
		from = {
			oxr_mdlc_world_machine_cores_recalc_amount = yes
			fire_on_action = {
				on_action = on_world_machine_core_terraforming_complete
			}
		}
	}
}

planet_event = {
	id = oxr_mdlc_origin_wm_main.501
	title = oxr_mdlc_origin_wm_main.501.title
	desc = oxr_mdlc_origin_wm_main.501.desc
	picture = GFX_evt_colony_settlement
	is_triggered_only = yes

	option = {
		name = oxr_mdlc_origin_wm_main.501.a
		space_owner = {
			add_resource = {
				society_research = 750
				engineering_research = 750
				physics_research = 750
			}
		}
	}
	option = {
		name = oxr_mdlc_origin_wm_main.501.b
		space_owner = {
			add_resource = {
				unity = 1000
			}
		}
	}
	option = {
		name = oxr_mdlc_origin_wm_main.501.c
		space_owner = {
			add_resource = {
				energy = -250
			}
		}
		planet_event = {
			id = oxr_mdlc_origin_wm_main.502
			days = 14
		}
	}
}

planet_event = {
	id = oxr_mdlc_origin_wm_main.502
	title = oxr_mdlc_origin_wm_main.502.title
	desc = oxr_mdlc_origin_wm_main.502.desc
	picture = GFX_evt_glitchy_matrix
	is_triggered_only = yes

	option = {
		name = "oxr_mdlc_origin_wm_main.502.a"
		space_owner = {
			random_situation = {
				limit = { is_situation_type = oxr_mdlc_origin_wm_situation_recover_core_tech }
				add_situation_progress = @oxr_mdlc_situation_core_tech_fun_points
			}
		}
	}
}

### RUINED WORLD MACHINE ###
# Decision triggers this event, which triggers others


# Introduction, enter stage 1
country_event = {
	id = oxr_mdlc_origin_wm_main.1000
	title = "oxr_mdlc_origin_wm_main.1000.title"
	desc = "oxr_mdlc_origin_wm_main.1000.desc"
	picture = GFX_evt_engineering_cache
	is_triggered_only = yes
	location = event_target:oxr_mdlc_ruined_world_machine

	trigger = {
		root = {
			any_situation = {
				is_situation_type = oxr_mdlc_origin_wm_situation_restore_ruined_world_machine
			}
		}
	}

	option = {
		name = oxr_mdlc_origin_wm_main.1000.a
		hidden_effect = {
			log = "Do nothing"
		}
	}
	immediate = { log = "Do nothing" }
}

country_event = {
	# enter stage 2, power on self test
	id = oxr_mdlc_origin_wm_main.1005
	title = oxr_mdlc_origin_wm_main.1005.title
	desc = oxr_mdlc_origin_wm_main.1005.desc
	picture = GFX_evt_engineering_cache
	is_triggered_only = yes
	

	option = {
		name = oxr_mdlc_origin_wm_main.1005.a
	}
	immediate = {}
}
country_event = {
	# enter stage 3, boot loader
	id = oxr_mdlc_origin_wm_main.1010
	title = oxr_mdlc_origin_wm_main.1010.title
	desc = oxr_mdlc_origin_wm_main.1010.desc
	picture = GFX_evt_engineering_cache
	is_triggered_only = yes

	option = {
		name = oxr_mdlc_origin_wm_main.1010.a
	}
	immediate = {}
}
country_event = {
	# enter stage 4, booting
	id = oxr_mdlc_origin_wm_main.1015
	title = oxr_mdlc_origin_wm_main.1015.title
	desc = oxr_mdlc_origin_wm_main.1015.desc
	picture = GFX_evt_engineering_cache
	is_triggered_only = yes

	option = {
		name = oxr_mdlc_origin_wm_main.1015.a
	}
	immediate = {}
}
country_event = {
	# enter stage 5, continue installation
	id = oxr_mdlc_origin_wm_main.1020
	title = oxr_mdlc_origin_wm_main.1020.title
	desc = oxr_mdlc_origin_wm_main.1020.desc
	picture = GFX_evt_engineering_cache
	is_triggered_only = yes

	option = {
		name = oxr_mdlc_origin_wm_main.1020.a
	}
	immediate = {}
}
# ALL DONE WITH RESTORATION
country_event = {
	id = oxr_mdlc_origin_wm_main.1025
	title = oxr_mdlc_origin_wm_main.1025.title
	desc = oxr_mdlc_origin_wm_main.1025.desc
	picture = GFX_evt_colony_settlement
	is_triggered_only = yes

	immediate = {
		event_target:oxr_mdlc_ruined_world_machine = {
			change_pc = xvcv_mdlc_pc_machine_auto
			planet_event = { id = oxr_mdlc_origin_wm_main.500 }
		}
	}

	option = {
		name = oxr_mdlc_origin_wm_main.1025.a
		add_resource = {
			physics_research = 750
			society_research = 750
			engineering_research = 750
			unity = 500
		}
		hidden_effect = {
			if = {
				limit = {
					has_event_chain = "oxr_mdlc_origin_wm_chain_deploy_world_cores"
					NOT = { has_completed_event_chain = oxr_mdlc_origin_wm_chain_deploy_world_cores }
				}
				# bump up the event chain tracker
				country_event = {
					id = oxr_mdlc_origin_wm_main.1100
				}
			}
		}
	}
}
# Add progress to initial 'Expand empire' situation
country_event = {
	id = oxr_mdlc_origin_wm_main.1100
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_event_chain = oxr_mdlc_origin_wm_chain_deploy_world_cores
	}

	immediate = {
		if = {
			limit = {
				has_event_chain = "oxr_mdlc_origin_wm_chain_deploy_world_cores"
				NOT = { has_completed_event_chain = oxr_mdlc_origin_wm_chain_deploy_world_cores }
			}
			add_event_chain_counter = {
				event_chain = "oxr_mdlc_origin_wm_chain_deploy_world_cores"
				counter = "oxr_mdlc_origin_wm_starting_cores_deployed"
				amount = 1
			}
			# TODO: award insight points
		}
		# check for completion
		if = {
			limit = {
				has_completed_event_chain_counter = {
					event_chain = "oxr_mdlc_origin_wm_chain_deploy_world_cores"
					counter = "oxr_mdlc_origin_wm_starting_cores_deployed"
				}
				NOT = {
					has_technology = oxr_mdlc_tech_world_machine_planetary_proficiency
				}
			}
			# Trigger completion
			country_event = {
				id = oxr_mdlc_origin_wm_main.60
			}
		}
	}
}

# Completed gathering World Machine insights
country_event = {
	id = oxr_mdlc_origin_wm_main.1200
	title = oxr_mdlc_origin_wm_main.1200.title
	desc = oxr_mdlc_origin_wm_main.1200.desc
	picture = GFX_evt_analyzing_artifacts
	is_triggered_only = yes

	option = {
		name = oxr_mdlc_origin_wm_main.1200.a
		enable_special_project = {
			name = OXR_MDLC_ORIGIN_WM_CORE_TECH_RESEARCH_PHYSICS_1
		}
		enable_special_project = {
			name = OXR_MDLC_ORIGIN_WM_CORE_TECH_RESEARCH_ENGINEERING
		}
		enable_special_project = {
			name = OXR_MDLC_ORIGIN_WM_CORE_TECH_RESEARCH_SOCIETY
		}
	}
}

# Completed special project to research World Machine Cores
# This event is called on each project completion to see if they
# have all been completed
country_event = {
	id = oxr_mdlc_origin_wm_main.1210
	name = "oxr_mdlc_origin_wm_main.1210.title"
	desc = "oxr_mdlc_origin_wm_main.1210.desc"
	picture = GFX_evt_sapient_AI
	show_sound = event_mind_over_matter
	is_triggered_only = yes

	option = {
		name = "oxr_mdlc_origin_wm_main.1210.a"
		set_country_flag = oxr_mdlc_world_machine_core_tech_obtained
		owner = {
			add_research_option = oxr_mdlc_tech_fractal_basics
		}
		give_technology = {
			tech = oxr_mdlc_tech_world_machine_wmc_core
			message = no
		}
		
	}
}